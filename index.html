<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Mixed Movie Magic ‚Äì Heads Up!</title>
  <meta name="theme-color" content="#0b1020" />
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --ink:#eaf2ff; --muted:#9fb3ff; --accent:#7cf8ff; --good:#33d17a; --bad:#ff6b6b; --warn:#ffd166;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;background:var(--bg);color:var(--ink);}
    .wrap{max-width:720px;margin:0 auto;padding:clamp(12px,2.5vw,24px);}
    h1{font-size:clamp(22px,6vw,36px);margin:12px 0 8px;letter-spacing:.5px}
    h2{font-size:clamp(16px,4vw,22px);margin:8px 0 6px;color:var(--muted)}
    .card{background:linear-gradient(180deg,#121a33,#0f1730);border:1px solid #1e2a55;border-radius:22px;box-shadow:0 12px 30px rgba(0,0,0,.35);}
    .pad{padding:18px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;border:1px solid #223263;background:#0f1730;color:var(--ink);font-size:14px}
    button{appearance:none;border:none;background:#182248;color:var(--ink);padding:14px 16px;border-radius:16px;font-size:16px;font-weight:700;letter-spacing:.25px;box-shadow:0 6px 16px rgba(0,0,0,.25);}
    button:active{transform:scale(.98)}
    button.primary{background:linear-gradient(180deg,#2a6fff,#5df3ff);color:#001025}
    button.good{background:linear-gradient(180deg,#2bd67b,#7dffc0);color:#001b0b}
    button.bad{background:linear-gradient(180deg,#ff6b6b,#ffb3b3);color:#220000}
    button.warn{background:linear-gradient(180deg,#ffd166,#ffe29e);color:#221700}.section{margin:16px 0}
select, input[type="number"], input[type="text"]{width:100%;padding:12px 14px;border-radius:14px;border:1px solid #1f2b59;background:#0f1730;color:var(--ink);font-size:16px}

/* Game screen */
.screen{display:block}
.screen:not(.active){display:none}
.bigCard{display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;min-height:56vh;border-radius:24px;padding:22px;margin-top:14px;background:
  radial-gradient(1200px 400px at 50% -200px, rgba(124,248,255,.15), transparent),
  linear-gradient(180deg,#111a36,#08112a);
  border:1px solid #1e2a55;
}
.bigCat{font-size:14px;color:var(--muted);letter-spacing:.8px;text-transform:uppercase}
.bigWord{font-size:clamp(28px,8vw,44px);font-weight:900;margin-top:10px;line-height:1.12}
.timer{font-variant-numeric:tabular-nums;font-size:clamp(34px,10vw,54px);font-weight:800;margin-top:8px;color:var(--accent)}
.count{font-size:14px;color:var(--muted)}
.glass{backdrop-filter:blur(8px);background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:12px}
.footBar{display:flex;gap:10px;position:sticky;bottom:0;margin-top:14px}
.footBar > button{flex:1}

.small{font-size:12px;color:var(--muted)}
.center{display:flex;justify-content:center;align-items:center}
.hidden{display:none!important}
#debug{background:#222;border-bottom:1px solid #444;padding:8px 12px;font-size:12px}

  </style>
</head>
<body>
  <div id="debug">App loaded. If this stays visible, something blocked the script.</div>
  <div class="wrap">
    <!-- SCREEN: HOME -->
    <section id="home" class="screen active">
      <h1>Mixed Movie Magic ‚Äì Heads Up!</h1>
      <p class="small">Swipe ‚Üí = Correct, ‚Üê = Pass. Or turn on tilt controls: flip down = Correct, flip up = Pass.</p>
      <div class="card pad section">
        <h2>Choose Category</h2>
        <select id="category"></select>
        <div class="row" style="margin-top:10px">
          <div class="chip">‚è± Round Time: <input type="number" id="roundTime" min="20" max="180" step="5" value="60" style="width:110px"></div>
          <div class="chip">üîÅ No Repeats: <input type="checkbox" id="noRepeats" checked></div>
          <div class="chip">üì± Tilt Controls: <input type="checkbox" id="tiltToggle"></div>
        </div>
        <div class="small">If using tilt on iPhone, you'll be asked to allow motion access.</div>
      </div>
      <div class="row section">
        <button class="warn" id="howTo">How to Play</button>
        <button class="primary" id="startBtn">Start Round</button>
      </div>
      <div id="howToBox" class="card pad section hidden">
        <h2>How it works</h2>
        <ol>
          <li>Pick a category or <b>All (Mix)</b> and tap <b>Start Round</b>.</li>
          <li>Hold to the guesser‚Äôs forehead (or just show the screen).</li>
          <li>No saying the word(s) on the card. Correct = +1, Pass = skip.</li>
          <li>Controls: Swipe, Buttons, or <b>Tilt</b> (flip down = Correct, flip up = Pass).</li>
        </ol>
      </div>
    </section><!-- SCREEN: GAME -->
<section id="game" class="screen">
  <div class="row">
    <div class="glass">Category: <b id="liveCat"></b></div>
    <div class="glass">Score: <b id="score">0</b></div>
    <div class="glass">Left: <b id="left">0</b></div>
    <div class="glass" id="tiltStatus" style="display:none">Tilt: <b id="tiltState">OFF</b></div>
  </div>
  <div class="bigCard" id="bigCard">
    <div class="bigCat" id="bigCat"></div>
    <div class="bigWord" id="bigWord">‚Äî</div>
    <div class="timer" id="timer">60</div>
    <div class="count small">(tap buttons, swipe, or tilt)</div>
  </div>
  <div class="footBar">
    <button class="bad" id="passBtn">Pass</button>
    <button class="good" id="correctBtn">Correct</button>
  </div>
</section>

<!-- SCREEN: RESULTS -->
<section id="results" class="screen">
  <h2>Round Results</h2>
  <div class="card pad section" id="summary"></div>
  <div class="row">
    <button id="again" class="primary">Play Again</button>
    <button id="homeBtn">Back Home</button>
  </div>
</section>

  </div>  <script>
    // Hide debug banner after JS begins
    (function(){ const dbg = document.getElementById('debug'); if(dbg) setTimeout(()=>{ dbg.style.display='none'; }, 600); })();

    // --- DATA ---
    const categories = {
      "Emperor's New Groove": [
        "Kuzco","Pacha","Yzma","Kronk","Chicha","Chaca","Tipo","Bucky the Squirrel",
        "Spinach Puffs","Pull the lever","Secret Lab","Llama Potion","No touchy!","Boom, baby!"
      ],
      "Zootopia": [
        "Judy Hopps","Nick Wilde","Chief Bogo","Dawn Bellwether","Flash","Gazelle","Finnick",
        "Zootopia Police Department","Carrot Pen","Mr. Big","Tundratown","Howler Juice"
      ],
      "Freaky Friday": [
        "Anna Coleman","Tess Coleman","Magic Fortune Cookie","The Switch","The Wedding",
        "Guitar Audition","Therapy Session","School Band","Grandpa Alan","Electric Guitar"
      ],
      "Ratatouille": [
        "Remy","Linguini","Colette","Anton Ego","Gusteau","Emile","Skinner",
        "Anyone Can Cook","Gusteau's Restaurant","Ratatouille Dish","Health Inspector"
      ],
      "Star Wars": [
        "Luke Skywalker","Darth Vader","Princess Leia","Han Solo","Yoda","Chewbacca","R2-D2","C-3PO",
        "Lightsaber Battle","The Force","Millennium Falcon","Tatooine","Death Star"
      ],
      "Harry Potter": [
        "Harry Potter","Hermione Granger","Ron Weasley","Albus Dumbledore","Severus Snape","Voldemort",
        "Hogwarts","Quidditch","Broomstick","Sorting Hat","Patronus","Golden Snitch"
      ],
      "Wildcards": [
        "One-word clues only","Act it out (no talking)","Whisper clues","Robot voice only",
        "Rhymes only (no exact words)","Switch clue-giver now","Reverse round: guesser talks",
        "Freeze if you say 'um'","Speed round: 3 seconds per card","Animal sounds only"
      ]
    };

    // --- STATE ---
    let pool=[], used=new Set(), roundList=[], idx=0, score=0, timerId=null, remaining=60, activeCat="";

    // Tilt state
    let tiltEnabled=false, neutral=0, tilting=false, armed=true, tiltListener=null, calTimer=null;

    // Utility
    const shuffle = (arr)=>arr.sort(()=>Math.random()-0.5);
    const vibrate = (ms)=>{ if(navigator.vibrate) navigator.vibrate(ms); };

    // Wake Lock (best effort)
    let wakeLock; async function requestWakeLock(){ try{ if('wakeLock' in navigator){ wakeLock = await navigator.wakeLock.request('screen'); } }catch(e){} }

    // Populate category select
    const catSel = document.getElementById('category');
    const catNames = Object.keys(categories);
    const mixOpt = document.createElement('option'); mixOpt.value='__ALL__'; mixOpt.textContent='All (Mix)'; catSel.appendChild(mixOpt);
    catNames.forEach(c=>{ const o=document.createElement('option'); o.value=c; o.textContent=c; catSel.appendChild(o); });

    // Elements
    const screens={ home:document.getElementById('home'), game:document.getElementById('game'), results:document.getElementById('results') };
    const liveCat=document.getElementById('liveCat');
    const bigCat=document.getElementById('bigCat');
    const bigWord=document.getElementById('bigWord');
    const timerEl=document.getElementById('timer');
    const scoreEl=document.getElementById('score');
    const leftEl=document.getElementById('left');
    const howTo=document.getElementById('howTo');
    const howToBox=document.getElementById('howToBox');
    const tiltToggle=document.getElementById('tiltToggle');
    const tiltStatus=document.getElementById('tiltStatus');
    const tiltState=document.getElementById('tiltState');

    function show(name){ Object.values(screens).forEach(s=>s.classList.remove('active')); screens[name].classList.add('active'); }

    // Start Round
    document.getElementById('startBtn').addEventListener('click', async ()=>{
      const cat = catSel.value;
      const seconds = Math.max(20, Math.min(180, +document.getElementById('roundTime').value||60));
      const noRepeats = document.getElementById('noRepeats').checked;
      tiltEnabled = !!tiltToggle.checked;
      tiltStatus.style.display = tiltEnabled ? 'block' : 'none';
      tiltState.textContent = tiltEnabled ? 'Calibrating‚Ä¶' : 'OFF';

      activeCat = (cat === '__ALL__' ? 'All (Mix)' : cat);
      pool = (cat === '__ALL__') ? Object.values(categories).flat() : [...categories[cat]];
      if(noRepeats){ pool = pool.filter(w=>!used.has(`${activeCat}|${w}`)); }
      if(pool.length===0){ used.clear(); pool = (cat==='__ALL__') ? Object.values(categories).flat() : [...categories[cat]]; }
      shuffle(pool); roundList = pool.slice(); idx = 0; score = 0; remaining = seconds;

      liveCat.textContent = activeCat; bigCat.textContent = activeCat; leftEl.textContent = roundList.length;
      scoreEl.textContent = '0'; timerEl.textContent = remaining; timerEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--accent');
      nextCard(); show('game'); tick(); requestWakeLock();

      if(tiltEnabled){ await enableTilt(); }
    });

    function nextCard(){
      const left = Math.max(0, roundList.length - idx);
      leftEl.textContent = left;
      if(left<=0){ endRound(); return; }
      bigWord.textContent = roundList[idx];
    }

    function correct(){ score++; scoreEl.textContent = score; recordUse(true); idx++; nextCard(); vibrate(30); }
    function pass(){ recordUse(false); idx++; nextCard(); vibrate(10); }
    function recordUse(ok){ const key=`${activeCat}|${roundList[idx]}`; used.add(key); resultsLog.push({word:roundList[idx], ok}); }

    // Timer
    function tick(){
      timerEl.textContent = remaining;
      if(remaining<=5) timerEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--warn');
      timerId = setTimeout(()=>{ remaining--; (remaining<0)? endRound() : tick(); }, 1000);
    }

    // Gesture controls (swipe)
    let startX=null; const cardEl=document.getElementById('bigCard');
    cardEl.addEventListener('touchstart',e=>{ startX = e.changedTouches[0].clientX; });
    cardEl.addEventListener('touchend',e=>{ if(startX==null) return; const dx=e.changedTouches[0].clientX-startX; startX=null; if(Math.abs(dx)<40) return; (dx>0)?correct():pass(); });

    // Buttons
    document.getElementById('correctBtn').addEventListener('click', correct);
    document.getElementById('passBtn').addEventListener('click', pass);

    // How-to toggle
    howTo.addEventListener('click',()=> howToBox.classList.toggle('hidden'));

    // Results handling
    let resultsLog=[];
    function endRound(){
      try{ if(timerId) clearTimeout(timerId); }catch(e){}
      if(tiltListener){ window.removeEventListener('deviceorientation', tiltListener); tiltListener=null; }
      if(calTimer){ clearTimeout(calTimer); }
      timerId=null;
      const list = resultsLog.map(r=>`<li>${r.ok?"‚úÖ":"‚è≠Ô∏è"} ${r.word}</li>`).join('');
      document.getElementById('summary').innerHTML = `
        <div class="row" style="margin-bottom:10px">
          <div class="glass">Category: <b>${activeCat}</b></div>
          <div class="glass">Score: <b>${score}</b></div>
          <div class="glass">Cards Seen: <b>${resultsLog.length}</b></div>
        </div>
        <ol>${list}</ol>`;
      show('results'); resultsLog=[]; if(wakeLock){ try{ wakeLock.release(); }catch(e){} }
    }

    document.getElementById('again').addEventListener('click',()=>{ show('home'); document.getElementById('startBtn').click(); });
    document.getElementById('homeBtn').addEventListener('click',()=>{ show('home'); });

    // Keyboard (for desktop testing)
    window.addEventListener('keydown',e=>{ if(!screens.game.classList.contains('active')) return; if(e.key==='ArrowRight') correct(); if(e.key==='ArrowLeft') pass(); });

    // ---- Tilt Controls ----
    async function enableTilt(){
      // iOS permission
      try{
        if(typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function'){
          const res = await DeviceOrientationEvent.requestPermission(); if(res!=='granted'){ tiltState.textContent='Denied'; tiltEnabled=false; return; }
        }
      }catch(e){ /* ignore */ }
      // Calibrate neutral beta (face-forward) for 800ms
      let samples=[]; neutral=0; tiltState.textContent='Calibrating‚Ä¶';
      const calib = (e)=>{ if(typeof e.beta==='number') samples.push(e.beta); };
      window.addEventListener('deviceorientation', calib, {once:false, passive:true});
      await new Promise(r=>{ calTimer=setTimeout(r, 800); });
      window.removeEventListener('deviceorientation', calib);
      if(samples.length){ neutral = samples.reduce((a,b)=>a+b,0)/samples.length; }
      tiltState.textContent='Ready'; armed=true; tilting=false;

      // Listen for tilt actions
      const THRESH = 25; // degrees from neutral
      const HYST = 10;   // must come back within this to re-arm
      tiltListener = (e)=>{
        if(typeof e.beta !== 'number') return; // front/back tilt in degrees
        const delta = e.beta - neutral;
        // Flip down (toward ground) => Correct; Flip up (toward sky) => Pass
        if(armed){
          if(delta > THRESH){ tilting='down'; armed=false; correct(); tiltState.textContent='Down ‚Üí Correct'; setTimeout(()=>tiltState.textContent='Ready',500); }
          else if(delta < -THRESH){ tilting='up'; armed=false; pass(); tiltState.textContent='Up ‚Üí Pass'; setTimeout(()=>tiltState.textContent='Ready',500); }
        } else {
          // Re-arm when user returns near neutral
          if(Math.abs(delta) < HYST){ armed=true; }
        }
      };
      window.addEventListener('deviceorientation', tiltListener, {passive:true});
    }

    // Surface any JS errors on-screen so it's never blank
    window.addEventListener('error', (e)=>{ const dbg=document.getElementById('debug'); if(dbg){ dbg.style.display='block'; dbg.textContent = 'Error: '+ (e.message||'unknown'); } });
  </script><noscript><div style="padding:12px;background:#222;color:#fff">This game needs JavaScript enabled.</div></noscript>

</body>
</html>
